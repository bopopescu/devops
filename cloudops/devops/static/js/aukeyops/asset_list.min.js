$.getScript("/static/js/message.js");var Item=0;function addItem(){Item+=1;$("#add_item_group").append('    <div class="form-group" id="item_'+Item+'">        <input type="text" id="item_input_'+Item+'" style="display:none">        <label class="ivu-form-item-label pull-left col-md-2">        <input class="ivu-input" required="required" type="text" placeholder="字段名" id="item_label_'+Item+'" autocomplete="off"></label>        <div class="col-md-8 col-sm-8 col-xs-8" style="padding-right:0">        <input class="ivu-input" required="required" type="text" autocomplete="off" placeholder="值" id="item_value_'+Item+'"></div>        <div class="col-md-2 col-sm-2 col-xs-2" style="padding-left:0">        <button class="btn btn-link" type="button" onclick="delItem(\'item_'+Item+'\')" style="font-size:12px;">移除字段</button>        </div>    </div>')}function delItem(a){$("#"+a).remove()}function addAsset(){var e=$("#add_asset_id").val().replace(/(^\s*)|(\s*$)/g,"");var j=$("#add_asset_type_id").val().replace(/(^\s*)|(\s*$)/g,"");var b=$("#add_status_id").val().replace(/(^\s*)|(\s*$)/g,"");if(e==""){MyMessage(0,"资产编号不能为空！");return false}else{if(j==""){MyMessage(0,"资产类型不能为空！");return false}else{if(b==""){MyMessage(0,"状态不能为空！");return false}else{var c=$("#add_item_group").children().size();if(c>0){for(i=0;i<c;i++){var g=$("#add_item_group").children()[i].id;var d=$("#"+g+" input").attr("id");var a=$("#"+d);var f=$("#"+g+" label input").val();var h=$("#"+g+" div:first input").val();if(f==""){MyMessage(0,"字段名不能为空！");return false}else{if(h==""){MyMessage(0,"字段「"+f+"」的值不能为空！");return false}}a.attr("name",f);a.val(h)}}$("#add_submit_btn").addClass("ivu-btn-loading");$.ajax({url:"/cmdb/asset_manage/fixed_asset/add_asset/",type:"post",data:$("#add_asset_form").serialize(),success:function(k){MyMessage(k["code"],k["result"]);if(k["code"]==1){$("#table").bootstrapTable("refresh");Item=0;$("#myModal").modal("hide")}$("#add_submit_btn").removeClass("ivu-btn-loading")},error:function(){$("#add_submit_btn").removeClass("ivu-btn-loading")}})}}}}$(function(){$("#add_asset_type_id").change(function(a){$.ajax({url:"/cmdb/asset_manage/fixed_asset/get_asset_field/",type:"post",data:{"type_id":a.target.value},success:function(b){$("#add_my_field_group").empty();if(b["result"]){var c=0;for(i in b["result"]){c+=1;$("#add_my_field_group").append('                        <div class="form-group" id="my_field_'+c+'">                            <label class="ivu-form-item-label pull-left col-md-2">'+b["result"][i]+'</label>                            <div class="col-md-10 col-sm-10 col-xs-10" style="padding-right:0">                            <input class="ivu-input" required="required" type="text" autocomplete="off"                             name="'+b["result"][i]+'" id="my_field_value_'+c+'"></div>                        </div>')}}}})})});function openAssetOut(){var a=getSelectRow();if(a&&a.status){if(a.status!="在库"){MyMessage(0,"该资产目前为「"+a.status+"」状态，不能借出！");return false}else{$("#assetOutModal").modal("show");if(a.asset_id){$("#asset_out_id").val(a.asset_id)}}}else{$("#assetOutModal").modal("show")}}function ActionassetOut(){if($("#asset_out_id").val()==""){MyMessage(0,"资产编号不能为空！")}else{if($("#asset_use_person_id").val()==""){MyMessage(0,"领用人不能为空！")}else{$("#asset_out_submit_btn").addClass("ivu-btn-loading");$.ajax({url:"/cmdb/asset_manage/fixed_asset/asset_out/",type:"post",data:$("#asset_out_form").serialize(),success:function(a){MyMessage(a["code"],a["result"]);if(a["code"]==1){$("#assetOutModal").modal("hide");$("#table").bootstrapTable("refresh")}$("#asset_out_submit_btn").removeClass("ivu-btn-loading")},error:function(){$("#asset_out_submit_btn").removeClass("ivu-btn-loading")}})}}}function openAssetBack(){var a=getSelectRow();if(a&&a.status){if(a.status=="在库"){MyMessage(0,"该资产目前为「"+a.status+"」状态，不能归还！");return false}else{$("#assetBackModal").modal("show");if(a.asset_id){$("#asset_back_id").val(a.asset_id);$.ajax({url:"/cmdb/asset_manage/fixed_asset/judge_back_person/",type:"post",data:{"asset_id":a.asset_id},success:function(b){$("#asset_back_person_id").val(b["result"])}})}}}else{$("#assetBackModal").modal("show")}}function ActionassetBack(){if($("#asset_back_id").val()==""){MyMessage(0,"资产编号不能为空!")}else{if($("#asset_back_person_id").val()==""){MyMessage(0,"归还人不能为空！")}else{$("#asset_back_submit_btn").addClass("ivu-btn-loading");$.ajax({url:"/cmdb/asset_manage/fixed_asset/asset_back/",type:"post",data:$("#asset_back_form").serialize(),success:function(a){MyMessage(a["code"],a["result"]);if(a["code"]==1){$("#assetBackModal").modal("hide");$("#table").bootstrapTable("refresh")}$("#asset_back_submit_btn").removeClass("ivu-btn-loading")},error:function(){$("#asset_back_submit_btn").removeClass("ivu-btn-loading")}})}}}function openAssetMaintain(){var a=getSelectRow();if(a&&a.status){if(a.status!="在库"){MyMessage(0,"该资产目前为「"+a.status+"」状态，不能维修！");return false}else{$("#assetMaintainModal").modal("show");if(a.asset_id){$("#asset_maintain_id").val(a.asset_id)
}}}else{$("#assetMaintainModal").modal("show")}}$("#supplier_ma_input_id").click(function(){if($("#supplier_ma_input_id").is(":checked")){if($("#asset_maintain_id").val()==""){MyMessage(0,"请先填写资产编号！");return false}else{$.ajax({url:"/cmdb/asset_manage/fixed_asset/judge_supplier/",type:"post",data:{"asset_id":$("#asset_maintain_id").val()},success:function(a){if(a["code"]==1){$("#asset_maintain_person_id").val(a["result"]);$("#asset_maintain_person_id").attr("readOnly","false")}else{MyMessage(0,a["result"]);$("#supplier_ma_input_id").prop("checked",false)}}})}}else{$("#asset_maintain_person_id").removeAttr("readOnly")}});function ActionassetMaintain(){if($("#asset_maintain_id").val()==""){MyMessage(0,"资产编号不能为空！");return false}else{if($("#asset_maintain_person_id").val()==""){MyMessage(0,"维修方不能为空！");return false}else{$("#asset_maintain_submit_btn").addClass("ivu-btn-loading");$.ajax({url:"/cmdb/asset_manage/fixed_asset/asset_maintain/",type:"post",data:$("#asset_maintain_form").serialize(),success:function(a){MyMessage(a["code"],a["result"]);if(a["code"]==1){$("#assetMaintainModal").modal("hide");$("#table").bootstrapTable("refresh")}$("#asset_maintain_submit_btn").removeClass("ivu-btn-loading")},error:function(){$("#asset_maintain_submit_btn").removeClass("ivu-btn-loading")}})}}}function openAssetScrap(){var a=getSelectRow();if(a&&a.status){if(a.status!="在库"){MyMessage(0,"该资产目前为「"+a.status+"」状态，不能报废！");return false}else{$("#assetScrapModal").modal("show");if(a.asset_id){$("#asset_scrap_id").val(a.asset_id)}}}else{$("#assetScrapModal").modal("show")}}function ActionassetScrap(){if($("#asset_scrap_id").val()==""){MyMessage(0,"资产编号不能为空！")}else{$("#asset_scrap_submit_btn").addClass("ivu-btn-loading");$.ajax({url:"/cmdb/asset_manage/fixed_asset/asset_scrap/",type:"post",data:$("#asset_scrap_form").serialize(),success:function(a){MyMessage(a["code"],a["result"]);if(a["code"]==1){$("#assetScrapModal").modal("hide");$("#table").bootstrapTable("refresh")}$("#asset_scrap_submit_btn").removeClass("ivu-btn-loading")},error:function(){$("#asset_scrap_submit_btn").removeClass("ivu-btn-loading")}})}}function confirmDelete(){var a=getSelectRow();if(a&&a.status){if(a.status!="在库"){MyMessage(0,"该资产目前为「"+a.status+"」状态，不能删除！");return false}else{if(a.asset_id){$.confirm({title:"提示！",content:"确定要删除资产「"+a.asset_id+"」吗？",closeIcon:true,confirmButtonClass:"btn-danger",cancelButtonClass:"btn-default ",confirmButton:"删除!",cancelButton:"取消",confirm:function(){ActionassetDelete(a.asset_id)}})}else{MyMessage(0,"请选择资产！")}}}else{MyMessage(0,"请选择资产！")}}function ActionassetDelete(a){if(a){$.ajax({url:"/cmdb/asset_manage/fixed_asset/delete_asset/",type:"post",data:{"asset_id":a},success:function(b){MyMessage(b["code"],b["result"]);if(b["code"]==1){$("#table").bootstrapTable("refresh")}}})}else{MyMessage(0,"请选择资产！")}}function confirmTypeDelete(){var a=getSelectRow();if(a&&a.type_id){$.confirm({title:"提示！",content:"确定要删除资产类型「"+a.name+"」吗？",closeIcon:true,confirmButtonClass:"btn-danger",cancelButtonClass:"btn-default ",confirmButton:"删除!",cancelButton:"取消",confirm:function(){$.ajax({url:"/cmdb/asset_manage/fixed_asset/delete_asset_type/",type:"post",data:{"type_id":a.type_id},success:function(b){MyMessage(b["code"],b["result"]);if(b["code"]==1){$("#table").bootstrapTable("refresh")}}})}})}else{MyMessage(0,"请选择资产类型！")}}function confirmSupplierDelete(){var a=getSelectRow();if(a&&a.supplier_id){$.confirm({title:"提示！",content:"确定要删除供应商「"+a.name+"」吗？",closeIcon:true,confirmButtonClass:"btn-danger",cancelButtonClass:"btn-default ",confirmButton:"删除!",cancelButton:"取消",confirm:function(){$.ajax({url:"/cmdb/asset_manage/fixed_asset/delete_supplier/",type:"post",data:{"supplier_id":a.supplier_id},success:function(b){MyMessage(b["code"],b["result"]);if(b["code"]==1){$("#table").bootstrapTable("refresh")}}})}})}else{MyMessage(0,"请选择供应商！")}}var tag_mum=0;function closeTag(a){$("#"+a).remove()}function ActionassetTypeAdd(){var a=[];$("#tags").children("span")[0];for(i in $("#tags").children("span")){span_id=$("#tags").children("span")[i].id;if(span_id){a.push($("#"+span_id+" span").text().replace(/(^\s*)|(\s*$)/g,""))}}if($("#asset_type_add_id").val()==""){MyMessage(0,"类型名称不能为空！")}else{$.ajax({url:"/cmdb/asset_type_change",type:"post",data:{"asset_type_add_name":$("#asset_type_add_id").val(),"my_field":a+"","asset_form_type_name":$("#asset_form_type_id").val()},success:function(b){MyMessage(b["code"],b["result"]);if(b["code"]==1){tag_mum=0;$("#assetTypeAddModal").modal("hide");$("#table").bootstrapTable("refresh")}}})}}$(function(){$(".tags_enter").blur(function(){var a=$(this).val().trim();if(a!=""){addTag($(this));$(this).parents(".type_add_tags").css({"border-color":"#d5d5d5"})}}).keydown(function(b){var c=b.keyCode;var a=$(this).val().trim();if(c==13&&a!=""){addTag($(this))}if(c==32&&a!=""){addTag($(this))}});$(".type_add_tags").click(function(){$(this).css({"border-color":"#57a3f3"})}).blur(function(){$(this).css({"border-color":"#d5d5d5"})})});function addTag(c){var a=c.val().replace(/(^\s*)|(\s*$)/g,"");
if(a!=""){var b=0;$(".type_add_tag").each(function(){if($(this).text()==a+"×"){$(this).addClass("tag-warning");setTimeout("removeWarning()",400);b++}});c.val("");if(b>0){return false}$("#form-field-tags").before("<span class='type_add_tag' id='type_add_tag_id_"+tag_mum+"'><span>"+a+"</span><button class='close' type='button' onclick='closeTag(\"type_add_tag_id_"+tag_mum+"\")'>×</button></span>")}tag_mum+=1}function removeWarning(){$(".tag-warning").removeClass("tag-warning")}function ActionassetSupplierChange(){if($("#change_supplier_name_id").val()==""){MyMessage(0,"供应商名称不能为空！")}else{$.ajax({url:"/cmdb/supplier_change",type:"post",data:$("#asset_supplier_change_form").serializeArray(),success:function(a){MyMessage(a["code"],a["result"]);if(a["code"]==1){tag_mum=0;$("#assetSupplierChangeModal").modal("hide");$("#table").bootstrapTable("refresh")}}})}}var TableExport=function(){var a=function(){$(".export-excel").on("click",function(c){c.preventDefault();var d=$(this).data("table");var b=$(this).data("ignorecolumn");$(d).tableExport({type:"excel",escape:"false",ignoreColumn:"["+b+"]"})})};return{init:function(){a()}}}(jQuery);TableExport.init();$(".selectpicker").selectpicker({noneSelectedText:""});function getSelectRow(){var b=$("#table").bootstrapTable("getSelections",function(c){return c});for(i in b){var a=b[i]}return a}$(document).ready(function(){initTable();$.ajax({url:"/cmdb/get_supplier",type:"get",success:function(a){$.each(a.result,function(b,c){$("#supplier_id.selectpicker").append("<option value="+c["value"]+">"+c["name"]+"</option>")});$("#supplier_id").selectpicker("refresh")}});$.ajax({url:"/cmdb/get_asset_type",type:"get",success:function(a){$("#custom_export_asset_type_id.selectpicker").append('<option value=""></option>');$.each(a.result,function(b,c){$("#asset_type_id.selectpicker").append("<option value="+c["value"]+">"+c["name"]+"</option>");$("#custom_export_asset_type_id.selectpicker").append("<option value="+c["value"]+">"+c["name"]+"</option>")});$("#asset_type_id").selectpicker("refresh");$("#custom_export_asset_type_id.selectpicker").selectpicker("refresh")}});$.ajax({url:"/cmdb/get_all_user/",type:"get",success:function(a){$("#operator_id.selectpicker").append("<option></option>");$.each(a.result,function(b,c){$("#operator_id.selectpicker").append("<option value="+c["value"]+">"+c["name"]+"</option>")});$("#operator_id").selectpicker("refresh")}});$.ajax({url:"/cmdb/get_org/",type:"post",async:false,success:function(a){if(a["result"]){for(i in a["result"]){if(a["result"][i]["id"]==1){a["result"][i]["open"]="true";break}}zTreeObj=$.fn.zTree.init($("#treeDemo"),setting,a["result"])}}})});var zTreeObj;var setting={data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentid",rootPId:0}},check:{enable:true},callback:{onClick:zTreeOnClick}};function zTreeOnClick(a,c,b){$("#orgModal").modal("hide");$("#org_search_input_id").val(b.name)}function viewsCutover(a){if(a==1){$("#table").bootstrapTable("refreshOptions",{url:"/cmdb/asset_manage/fixed_asset/fixed_asset_list/",pagination:true,detailView:true,pageNumber:1,columns:[{title:"",field:"select",checkbox:true,width:20,align:"center",valign:"middle"},{title:"资产编号",field:"asset_id",sortable:true},{title:"SN",field:"sn",sortable:false},{title:"资产类型",field:"asset_type",sortable:true},{title:"操作人",field:"operator",sortable:true},{title:"操作时间",field:"operate_time",sortable:true},{title:"采购日期",field:"buy_time",sortable:true},{title:"供应商",field:"supplier",sortable:true},{title:"领用人",field:"use_person",sortable:true},{title:"领用时间",field:"use_time",sortable:true},{title:"资产状态",field:"status",sortable:true},{title:"备注",field:"remark",sortable:true,width:250}],detailFormatter:function(c,d){var b="";$.ajax({url:"/cmdb/get_asset_detail/",type:"post",async:false,data:{"asset_id":d.asset_id},success:function(e){b=e["result"]}});return b}});document.getElementById("searchAssetId").style.display="block";document.getElementById("asset_search_btid").className="ivu-btn ivu-btn-primary";document.getElementById("asset_type_btid").className="ivu-btn ivu-btn-ghost";document.getElementById("asset_supplier_btid").className="ivu-btn ivu-btn-ghost";document.getElementById("asset_bt_group").style.display="block";document.getElementById("type_bt_group").style.display="none";document.getElementById("supplier_bt_group").style.display="none"}else{if(a==2){$("#table").bootstrapTable("refreshOptions",{url:"/cmdb/asset_manage/fixed_asset/asset_type_list/",pagination:true,detailView:false,pageNumber:1,columns:[{title:"",field:"select",checkbox:true,width:20,align:"center",valign:"middle"},{title:"类型ID",field:"type_id",sortable:false},{title:"类型名称",field:"name",sortable:false},{title:"自定义资产字段",field:"customize_asset_field",sortable:false}]});document.getElementById("searchAssetId").style.display="none";document.getElementById("asset_type_btid").className="ivu-btn ivu-btn-primary";document.getElementById("asset_search_btid").className="ivu-btn ivu-btn-ghost";document.getElementById("asset_supplier_btid").className="ivu-btn ivu-btn-ghost";
document.getElementById("asset_bt_group").style.display="none";document.getElementById("type_bt_group").style.display="block";document.getElementById("supplier_bt_group").style.display="none"}else{if(a==3){$("#table").bootstrapTable("refreshOptions",{url:"/cmdb/asset_manage/fixed_asset/supplier_manage_list/",pagination:true,detailView:false,pageNumber:1,columns:[{title:"",field:"select",checkbox:true,width:20,align:"center",valign:"middle"},{title:"供应商ID",field:"supplier_id",sortable:false},{title:"供应商名称",field:"name",sortable:false},{title:"联系人",field:"contact",sortable:false},{title:"固定电话",field:"fixed_telephone",sortable:false},{title:"手机号码",field:"mobile_phone",sortable:false},{title:"地址",field:"address",sortable:false},{title:"邮箱",field:"email",sortable:false},{title:"QQ",field:"qq",sortable:false},{title:"备注",field:"remark",sortable:false,width:250}]});document.getElementById("searchAssetId").style.display="none";document.getElementById("asset_type_btid").className="ivu-btn ivu-btn-ghost";document.getElementById("asset_search_btid").className="ivu-btn ivu-btn-ghost";document.getElementById("asset_supplier_btid").className="ivu-btn ivu-btn-primary";document.getElementById("asset_bt_group").style.display="none";document.getElementById("type_bt_group").style.display="none";document.getElementById("supplier_bt_group").style.display="block"}}}}$("#searchAssets").on("click",function(){searchTable("table","searchAssetId")});function formReset(){document.getElementById("searchAssetId").reset();$(".selectpicker").selectpicker("refresh")}function initTable(){$("#table").bootstrapTable({method:"post",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",cache:false,url:"/cmdb/asset_manage/fixed_asset/fixed_asset_list/",toolbar:"#toolbar",striped:true,minimumCountColumns:1,dataField:"rows",pagination:true,sortable:true,pageSize:15,pageNumber:1,pageList:[5,10,15,20,25,"All"],search:false,searchOnEnterKey:true,searchAlign:"left",showColumns:false,showRefresh:false,showSearchButton:false,showExport:false,exportDataType:"all",sidePagination:"server",queryParamsType:"undefined",clickToSelect:true,singleSelect:true,checkboxHeader:false,toolbarAlign:"left",buttonsAlign:"right",detailView:true,columns:[{title:"",field:"select",checkbox:true,width:20,align:"center",valign:"middle"},{title:"资产编号",field:"asset_id",sortable:true},{title:"SN",field:"sn",sortable:false},{title:"资产类型",field:"asset_type",sortable:true},{title:"操作人",field:"operator",sortable:true},{title:"操作时间",field:"operate_time",sortable:true},{title:"采购日期",field:"buy_time",sortable:true},{title:"供应商",field:"supplier",sortable:true},{title:"领用人",field:"use_person",sortable:true},{title:"领用时间",field:"use_time",sortable:true},{title:"资产状态",field:"status",sortable:true},{title:"备注",field:"remark",sortable:true,width:250}],queryParams:function a(c){var b={csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val(),pageNumber:c.pageNumber,pageSize:c.pageSize,search:c.searchText,order:c.sortOrder,sort:c.sortName};return b},detailFormatter:function(c,d){var b="";$.ajax({url:"/cmdb/get_asset_detail/",type:"post",async:false,data:{"asset_id":d.asset_id},success:function(e){b=e["result"]}});return b}})}$(".timeselect_input").daterangepicker({minDate:"01/01/2000",showDropdowns:true,showWeekNumbers:false,timePicker:false,timePickerIncrement:1440,timePicker12Hour:false,opens:"right",buttonClasses:["ivu-btn"],applyClass:"ivu-btn-primary",cancelClass:"ivu-btn-ghost",format:"YYYY-MM-DD",separator:"to",locale:{format:"YYYY-MM-DD",separator:"~",applyLabel:"确定",cancelLabel:"取消",resetLabel:"重置",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},function(c,a,b){});$(".timeselect_input").val("");$("#myModal").on("show.bs.modal",function(e){var f={};var d={};var g={"在库":1,"借出":2,"维修":3,"报废":4};$("#add_status_id.selectpicker").selectpicker("refresh");$("#add_asset_type_id.selectpicker").empty();$("#add_asset_type_id.selectpicker").append("<option></option>");$.ajax({url:"/cmdb/get_asset_type",type:"get",async:false,success:function(a){$.each(a.result,function(h,j){$("#add_asset_type_id.selectpicker").append("<option value="+j["value"]+">"+j["name"]+"</option>");f[j["name"]]=j["value"]});$("#add_asset_type_id").selectpicker("refresh")}});$("#add_supplier_id.selectpicker").empty();$("#add_supplier_id.selectpicker").append("<option></option>");$.ajax({url:"/cmdb/get_supplier",type:"get",async:false,success:function(a){$.each(a.result,function(h,j){$("#add_supplier_id.selectpicker").append("<option value="+j["value"]+">"+j["name"]+"</option>");d[j["name"]]=j["value"]});$("#add_supplier_id").selectpicker("refresh")}});jeDate("#add_buydate_id",{format:"YYYY-MM-DD",isTime:false,minDate:"2000-01-01 00:00:00"});var c=$(e.relatedTarget).data("id");if(c){$("#change_asset_title_id").html("修改资产");var b=getSelectRow();
if(b&&b.asset_id){$("#hidden_add_asset_id").val(b.asset_id);$("#add_asset_id").val(b.asset_id);$("#add_asset_id").attr("readOnly","false");$("#add_buydate_id").val(b.buy_time);$("#add_remark_id").val(b.remark);$("#add_asset_type_id").selectpicker("val",f[b.asset_type]);$("#add_asset_type_id").selectpicker("refresh");$("#add_supplier_id").selectpicker("val",d[b.supplier]);$("#add_supplier_id").selectpicker("refresh");$("#add_status_id").selectpicker("val",g[b.status]);$("#add_status_id").selectpicker("refresh");$.ajax({url:"/cmdb/asset_manage/fixed_asset/get_asset_field/",type:"post",data:{"type_id":f[b.asset_type],"asset_id":b.asset_id},success:function(a){$("#add_my_field_group").empty();if(a["the_value"]){var j=0;for(i in a["the_value"]){if(a["the_value"][i]){var h=a["the_value"][i]}else{var h=""}j+=1;$("#add_my_field_group").append('                            <div class="form-group" id="my_field_'+j+'">                                <label class="ivu-form-item-label pull-left col-md-2">'+i+'</label>                                <div class="col-md-10 col-sm-10 col-xs-10" style="padding-right:0">                                <input class="ivu-input" required="required" type="text" autocomplete="off" value="'+h+'"                                 name="'+i+'" id="my_field_value_'+j+'"></div>                            </div>')}}}})}else{MyMessage(0,"请选择资产！");return false}}else{$("#change_asset_title_id").html("添加资产");return true}});$("#myModal").on("hidden.bs.modal",function(){document.getElementById("add_asset_form").reset();$("#hidden_add_asset_id").val("");$("#add_my_field_group").empty();$("#add_item_group").empty();$("#add_asset_id").removeAttr("readOnly")});$("#assetOutModal").on("hidden.bs.modal",function(){document.getElementById("asset_out_form").reset();$("#asset_use_person_id").selectpicker("refresh")});$("#assetBackModal").on("hidden.bs.modal",function(){document.getElementById("asset_back_form").reset();$("#asset_back_person_id").selectpicker("refresh")});$("#assetMaintainModal").on("hidden.bs.modal",function(){document.getElementById("asset_maintain_form").reset();$("#asset_maintain_person_id").removeAttr("readOnly")});$("#assetTypeAddModal").on("hidden.bs.modal",function(){$("#asset_form_type_id").val("");document.getElementById("asset_type_add_form").reset();$("#tags span").remove()});$("#assetTypeAddModal").on("show.bs.modal",function(e){var d=$(e.relatedTarget).data("id");if(d){var b=getSelectRow();if(b&&b.type_id){$("#type_title_id").html("修改资产类型");$("#asset_form_type_id").val(b.type_id);$("#asset_type_add_id").val(b.name);if(b.customize_asset_field){var c=999;for(tag in b.customize_asset_field.split(",")){$("#form-field-tags").before("<span class='type_add_tag' id='type_add_tag_id_"+c+"'><span>"+b.customize_asset_field.split(",")[tag]+"</span><button class='close' type='button' onclick='closeTag(\"type_add_tag_id_"+c+"\")'>×</button></span>");c+=1}}}else{MyMessage(0,"请选择资产类型！");return false}}else{$("#type_title_id").html("添加资产类型")}});$("#assetSupplierChangeModal").on("hidden.bs.modal",function(){$("#change_supplier_id").val("");document.getElementById("asset_supplier_change_form").reset()});$("#assetSupplierChangeModal").on("show.bs.modal",function(d){var c=$(d.relatedTarget).data("id");if(c){var b=getSelectRow();if(b&&b.supplier_id){$("#supplier_title_id").html("修改供应商信息");$("#change_supplier_id").val(b.supplier_id);$("#change_supplier_name_id").val(b.name);$("#change_supplier_contact_id").val(b.contact);$("#change_supplier_fixed_telephone_id").val(b.fixed_telephone);$("#change_supplier_mobile_phone_id").val(b.mobile_phone);$("#change_supplier_address_id").val(b.address);$("#change_supplier_email_id").val(b.email);$("#change_supplier_qq_id").val(b.qq);$("#change_supplier_remark_id").val(b.remark)}else{MyMessage(0,"请选择供应商！");return false}}else{$("#supplier_title_id").html("添加供应商")}});$("#CountModal").on("show.bs.modal",function(){$.ajax({url:"/cmdb/asset_manage/fixed_asset/asset_count/",type:"post",success:function(a){var b="";for(i in a["result"]){b+="<tr><td>"+i+"</td>"+"<td>"+a["result"][i]["在库"]+"</td>"+"<td>"+a["result"][i]["借出"]+"</td>"+"<td>"+a["result"][i]["维修"]+"</td>"+"<td>"+a["result"][i]["报废"]+"</td>"+"<td>"+a["result"][i]["统计"]+"</td></tr>"}$("#asset_count_tbody_id").html(b)}})});$("#custom_export_asset_type_id").change(function(a){$.ajax({url:"/cmdb/asset_manage/fixed_asset/get_asset_field/",type:"post",data:{"type_id":a.target.value},success:function(b){if(b["result"]){var c=$("#custom_export_field_id.selectpicker");document.getElementById("custom_export_field_id").options.length=0;c.append('<option value="asset_id">资产编号</option>');c.append('<option value="asset_type">资产类型</option>');c.append('<option value="operator">操作人</option>');c.append('<option value="operate_time">操作时间</option>');c.append('<option value="buy_time">采购日期</option>');c.append('<option value="supplier">供应商</option>');c.append('<option value="use_person">领用人</option>');c.append('<option value="use_time">领用时间</option>');
c.append('<option value="status">资产状态</option>');c.append('<option value="remark">备注</option>');for(i in b["result"]){c.append("<option value="+b["result"][i]+">"+b["result"][i]+"</option>")}c.selectpicker("refresh")}}})});function CustomExportSubmit(){if(!$("#custom_export_asset_type_id").val()){MyMessage(0,"请选择资产类型！");return false}else{if(!$("#custom_export_field_id").val()){MyMessage(0,"请选择导出字段！");return false}}var a=$("#custom_export_form_id").serializeArray();$("#export_loading_id").show();$.ajax({url:"/cmdb/asset_manage/fixed_asset/custom_export/",type:"post",data:a,success:function(b){if(b["result"]["data_list"]){var d={};d.fileName="固定资产导出";d.datas=[{sheetFilter:b["result"]["field"],sheetHeader:b["result"]["field"],sheetData:b["result"]["data_list"],}];var c=new ExportJsonExcel(d);try{c.saveExcel();MyMessage(1,"导出成功！")}catch(e){MyMessage(2,"无数据！")}}else{MyMessage(2,"无数据！")}$("#export_loading_id").hide()},error:function(b){MyMessage(0,b.responseText);$("#export_loading_id").hide()}})};